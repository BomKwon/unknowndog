<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">
<head>
    <meta charset="UTF-8">
    <title>ëª¨ë¥´ëŠ” ê°œ ì‚°ì±… :: ê°€ì…í•˜ê°œ</title>


    <th:block layout:fragment="css">
        <!--css-->
        <style>
            .fieldError {
                color: red;
            }
        </style>
    </th:block>

    <!-- ì‚¬ìš©ì ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€-->
    <th:block layout:fragment="script">
        <script th:inline="javascript">

            $(document).ready(function errMsg() {

                var errorMessage = [[${errorMessage}]]
                if(errorMessage != null){
                    alert(errorMessage);
                }



                $("#emailChk").hide()
                $("#nNameChk").hide()


                var name = $("#name").val()
                var password = $("#password").val()
                var pw2 = $("#password2").val()
                var address = $("#address").val()




                //     ì´ë©”ì¼ ì¤‘ë³µì²´í¬
                $("#email").focusout(function () {


                    console.log("ì´ë©”ì¼ ìœ íš¨ì„±ê²€ì‚¬")

                    var email = $("#email").val()

                    var param = {
                        email : email
                    }

                    //ì…ë ¥í–ˆëŠ”ì§€ ì•ˆí–ˆëŠ”ì§€ ë³´ëŠ” ê²€ì‚¬
                    if (email == '' || email.length == 0) {
                        $("#label1").css("color", "lightcoral").text("ì´ë©”ì¼ì„ ì…ë ¥í•˜ê°œ!!!!");
                        return false;
                    }

                    // ì´ë©”ì¼ ìœ íš¨ì„±ê²€ì‚¬
                        email_regex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i;

                        if (!email_regex.test(email)) {
                            $("#label1").css("color", "lightcoral").text("ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ ì£¼ì†Œë‹¤ê°œ");
                            $("#emailChk").hide()
                            return false;
                        } else if (email_regex.test(email)) {

                            $("#emailChk").show()
                            $("#label1").css("color", "lightblue").text("ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œë‹¤ê°œ");

                            $("#emailChk").on("click" , function emailChk() {

                                //Ajaxë¡œ ì „ì†¡
                                $.ajax({
                                    url: '/user/duplicateE',
                                    data: param,
                                    type: 'POST',
                                    dataType: 'text',
                                    success: function (result) {
                                        console.log(result)
                                        $("#label1").css("color", "lightblue").text(result);
                                    },
                                    error : function (error) {
                                        alert("ì´ë©”ì¼ ì¤‘ë³µí™•ì¸ ì—ëŸ¬ë°œìƒ! " + error)
                                    }
                                })//End Ajax

                            })//end emailChkBtn function

                        }// end else if


                })//end focusout function


                //     ë³„ëª… ì¤‘ë³µì²´í¬
                $("#nickname").focusout(function() {


                    console.log("ë³„ëª… ìœ íš¨ì„±ê²€ì‚¬")

                    var nickname = $("#nickname").val()

                    var param = {
                        nickname : nickname
                    }

                    //ì…ë ¥í–ˆëŠ”ì§€ ì•ˆí–ˆëŠ”ì§€ ë³´ëŠ” ê²€ì‚¬
                    if (nickname == '' || nickname.length == 0) {
                        $("#label2").css("color", "lightcoral").text("ë³„ëª…ì„ ì…ë ¥í•˜ê°œ!!!!");
                        return false;
                    }


                    $("#nNameChk").show()

                    $("#nNameChk").on("click" , function nNameChk() {

                            //Ajaxë¡œ ì „ì†¡
                            $.ajax({
                                url: '/user/duplicateN',
                                data: param,
                                type: 'POST',
                                dataType: 'text',
                                success: function (result) {
                                    console.log(result)
                                    $("#label2").css("color", "lightblue").text(result);
                                },
                                error : function (error) {
                                    alert("ë³„ëª… ì¤‘ë³µí™•ì¸ ì—ëŸ¬ë°œìƒ! " + error)
                                }
                            })//End Ajax

                    })//end nNameChkBtn function

                })//end focusout function



                $(".regiBtn").on("click", function () {


                    if (name == '' || name.length == 0 || name == null) {
                        alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ê°œ")
                    }

                    if (password == '' || password.length == 0 ) {
                        alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ê°œ")
                    } else if (16 < password.length < 8) {
                        $("#label3").css("color", "lightcoral")
                            .text("ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒ, 16ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ê°œ");
                    }

                    $("#password2").focusout(function() {

                        var param1 = {
                            password : password,
                            password2 : pw2
                        }

                        //Ajaxë¡œ ì „ì†¡
                        $.ajax({
                            url: '/user/passwordChk',
                            data: param1,
                            type: 'POST',
                            dataType: 'text',
                            success: function (result) {
                                console.log(result)
                                $("#label3").css("color", "lightblue").text(result);
                            },
                            error : function (error) {
                                alert("ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì—ëŸ¬ë°œìƒ! " + error)
                            }
                        })

                    })

                    $("#address").focusout()(function () {
                        if (address == '', address.length == 0) {
                            alert("ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ê°œ")
                        }
                    })

                })









            });




        </script>


    </th:block>


</head>
<body>


<div layout:fragment="content">

    <div class="col">
        <div class="card border-light shadow">

            <div class="card-body">

                <h4>ğŸ£ ê°€ì…í•˜ê°œ</h4>

                <hr>

                <div class="row row-cols-1  row-cols-md-1">
                    <div class="col">

                            <div class="card-body">



                                <form action="/user/register" method="post" th:object="${userFormDTO}" >
                                    <!-- th:objectëŠ” th:field=*{í•„ë“œê°’}-->

                                    <!-- ì´ë¦„-->
                                    <div class="row g-5 align-items-center">
                                        <div class="col-auto">
                                            <label for="name" class="form-label">ì´  ë¦„</label>
                                        </div>

                                        <div class="col-auto">
                                            <input type="text" class="form-control" th:field="*{name}" > <!--placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ë¼ê°œ"-->
                                        </div>



                                    </div>

                                    <br>


                                    <!-- ì´ë©”ì¼-->
                                    <div class="row g-4 align-items-center">
                                        <div class="col-auto">
                                            <label for="email" class="form-label">ì´ ë©” ì¼</label>
                                        </div>

                                        <div class="col-auto" style="display:inline;">
                                            <input type="email" class="form-control" th:field="*{email}" ><!--placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ë¼ê°œ">-->
                                        </div>


                                        <div class="col-auto">
                                            <button type="button" value="dupCheckE" id="emailChk" class="btn btn-light text-nowrap"  style="background-color: honeydew; --bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;">ì¤‘ë³µí™•ì¸</button>
                                        </div>

                                        <div class="col-auto">
                                            <label id="label1"></label>
                                        </div>



                                    </div>

                                    <br>


                                    <!-- ë¹„ë°€ë²ˆí˜¸-->
                                    <div class="row g-4 align-items-center">
                                        <div class="col-auto">
                                        <label for="password" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                                        </div>

                                        <div class="col-auto">
                                        <input type="text" class="form-control"  th:field="*{password}" ><!--placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë¼ê°œ">-->
                                        </div>

                                        <div class="col-auto">
                                            <label for="password2" class="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                                        </div>

                                        <div class="col-auto">
                                            <input type="text" class="form-control"  th:field="*{password2}" ><!--placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë¼ê°œ">-->
                                        </div>

                                        <div class="col-auto">
                                            <label id="label3"></label>
                                        </div>


                                    </div>


                                    <br>


                                    <!-- ë‹‰ë„¤ì„-->
                                    <div class="row g-5 align-items-center">
                                        <div class="col-auto">
                                            <label for="nickname" class="form-label">ë³„  ëª…</label>
                                        </div>

                                        <div class="col-auto">
                                            <input type="text" class="form-control" th:field="*{nickname}" ><!--placeholder="ë³„ëª…ì„ ì…ë ¥í•˜ë¼ê°œ">-->
                                        </div>

                                        <div class="col-auto">
                                            <button type="button" value="dupCheckN" id="nNameChk" class="btn btn-light"  style="background-color: honeydew; --bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;">ì¤‘ë³µí™•ì¸</button>
                                        </div>

                                        <div class="col-auto">
                                            <label id="label2"></label>
                                        </div>

                                        <span id="nicknameHelpInline" class="form-text">
                                            <p th:if="${#fields.hasErrors('nickname')}"    th:errors="*{nickname}" class="fieldError" ></p>
                                        </span>

                                    </div>





                                    <br>


                                    <div class="row g-4 align-items-center">
                                        <div class="col-auto">
                                            <label for="birth" class="form-label">ìƒë…„ì›”ì¼</label>
                                        </div>
                                        <div class="col-auto">
                                            <input type="date" class="form-control" th:field="*{birth}" ><!--placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ë¼ê°œ">-->
                                        </div>



                                    </div>



                                    <br>



                                    <!-- ì£¼ì†Œ ì¶”í›„ ì…€ë ‰íŠ¸ ë°•ìŠ¤ë¡œ ë°”ê¿€ ê²ƒ -->
                                    <div class="row g-5 align-items-center">
                                        <div class="col-auto">
                                            <label for="address" class="form-label">ì£¼  ì†Œ</label>
                                        </div>
                                        <div class="col-auto">
                                            <input type="text" class="form-control" th:field="*{address}" ><!--placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ë¼ê°œ">-->
                                        </div>

                                        <div class="col-auto">
                                            <span id="addHelpInline" class="form-text">
                                                ë™ê¹Œì§€ ì…ë ¥í•´ì£¼ì‹œê°œ
                                            </span>
                                        </div>

                                    </div>



                                    <div>



                                    </div>





                                    <div style="text-align: center">
                                        <button type="button" class="btn btn-danger regiBtn">íšŒì›ê°€ì…</button>
                                    </div>


                                    <div th:unless="${#strings.isEmpty(userFormDTO.id)}">
                                        <button th:formaction="@{'/quest/modify/' + ${questFormDTO.id}  }" type="submit" class="btn btn-light btn-sm modBtn">ìˆ˜ì •</button>
                                        <a th:href="@{'/quest/remove/' + ${questId} }" class="btn btn-danger btn-sm delBtn">
                                            ì‚­ì œ
                                        </a>
                                    </div>

                                </form>

                            </div>


                    </div>

                </div>

            </div>

        </div>

    </div>





</div>

</body>
</html>